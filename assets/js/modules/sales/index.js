import{a as _,b as j,c as H,d as Y,e as S,f as $,g as V,h}from"../chunk-Z5J2ARA6.js";import{a as P,b as R,e as M,f as x,h as pe,i as O,j as A,k as D,n as k,o as J,p as K}from"../chunk-ZVGFYNKE.js";var n=M(x()),ne=M(pe());var f=M(x());var b={findProduct:"findProduct",findCustomer:"findCustomer",closeCash:"closeCash",openCash:"openCash",paidSale:"paidSale"};var ve=({openModal:e,customer:o})=>f.createElement(f.Fragment,null,f.createElement("div",{className:"breadcrumb-header justify-content-between"},f.createElement("div",{className:"my-auto"},f.createElement("div",{className:"d-flex"},f.createElement("h3",{className:"content-title mb-0 my-auto"},"Venta"))),f.createElement("div",{className:"d-flex my-xl-auto right-content"},f.createElement("div",{className:"pe-1 mb-xl-0"},f.createElement("button",{type:"button",className:"btn btn-success me-2",onClick:()=>e({modal:b.findCustomer,value:!0})},f.createElement("i",{className:"bi bi-person-circle"}))),f.createElement("div",{className:"pe-1 mb-xl-0"},f.createElement("button",{type:"button",className:"btn btn-primary me-2",disabled:o===null,onClick:()=>e({modal:b.findProduct,value:!0})},f.createElement("i",{className:"bi bi-search"}))),f.createElement("div",{className:"mb-xl-0"},f.createElement(V,{className:"btn-group dropdown"},f.createElement(V.Toggle,{variant:"warning",id:"dropdownMenuDate"},"Caja"),f.createElement(V.Menu,null,f.createElement(V.Item,{onClick:()=>e({modal:b.openCash,value:!0})},"Abrir"),f.createElement(V.Item,{onClick:()=>e({modal:b.closeCash,value:!0})},"Cerrar"))))))),U=ve;var a=M(x());var q=async({total:e,cambio:o,paid:r,customer:c,products:l})=>{let{data:u}=await K("/controller/ventas/crear.php",{total:e,cambio:o,paid:r,customer:c,products:l});return u};var Q=async e=>{let{data:o}=await J("/controller/clientes/filtro.php?filter="+e);return o},z=async e=>{let{data:o}=await J("/controller/productos/filtro.php?filter="+e);return o},G=async e=>{let{data:o}=await K("/controller/caja/abrir.php",{monto:e});return o},W=async(e,o)=>{let{data:r}=await K("/controller/caja/cerrar.php",{id:e,monto:o});return r},X=async e=>{let{data:o}=await J("/controller/stock/validar?idProducto="+e.idProducto);return o.data};var fe=({onPaid:e,show:o,onClose:r,montoInicial:c})=>{let[l,u]=a.useState(0),s=k({initialValues:{"1000":0,"500":0,"200":0,"100":0,"50":0,"20":0,monedas:0},onSubmit:async()=>{await e(l),C()}});a.useEffect(()=>{let E=Object.keys(s.values).map(T=>T==="monedas"?new Number(s.values[T]):new Number(T)*new Number(s.values[T])).reduce((T,L)=>T+=L,0);u(E)},[s.values]);let C=()=>{r(b.closeCash),s.resetForm()};return a.createElement(h,{show:o,onHide:C},a.createElement(h.Header,null,a.createElement("h5",{className:"modal-title",id:"exampleModalLabel"},"Cerrar Caja"),a.createElement("button",{type:"button",className:"btn-close",onClick:C})),a.createElement(h.Body,null,a.createElement("form",{onSubmit:s.handleSubmit},a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement("h4",null,"Fondo:")),a.createElement("div",{className:"col"},a.createElement("h5",{id:"fondoCaja"},S(c)))),a.createElement("div",{className:"row"},a.createElement("label",{htmlFor:"",className:"col"},"$1000"),a.createElement("div",{className:"col"},a.createElement("input",{type:"number",onChange:s.handleChange,value:s.values["1000"],min:"0",className:"form-control input-cierre",name:"1000"}))),a.createElement("div",{className:"row"},a.createElement("label",{htmlFor:"",className:"col"},"$500"),a.createElement("div",{className:"col"},a.createElement("input",{type:"number",onChange:s.handleChange,value:s.values["500"],min:"0",className:"form-control input-cierre",name:"500"}))),a.createElement("div",{className:"row"},a.createElement("label",{htmlFor:"",className:"col"},"$200"),a.createElement("div",{className:"col"},a.createElement("input",{type:"number",onChange:s.handleChange,value:s.values["200"],min:"0",className:"form-control input-cierre",name:"200"}))),a.createElement("div",{className:"row"},a.createElement("label",{htmlFor:"",className:"col"},"$100"),a.createElement("div",{className:"col"},a.createElement("input",{type:"number",onChange:s.handleChange,value:s.values["100"],min:"0",className:"form-control input-cierre",name:"100"}))),a.createElement("div",{className:"row"},a.createElement("label",{htmlFor:"",className:"col"},"$50"),a.createElement("div",{className:"col"},a.createElement("input",{type:"number",onChange:s.handleChange,value:s.values["50"],min:"0",className:"form-control input-cierre",name:"50"}))),a.createElement("div",{className:"row"},a.createElement("label",{htmlFor:"",className:"col"},"$20"),a.createElement("div",{className:"col"},a.createElement("input",{type:"number",onChange:s.handleChange,value:s.values["20"],min:"0",className:"form-control input-cierre",name:"20"}))),a.createElement("div",{className:"row"},a.createElement("label",{htmlFor:"",className:"col"},"Monedas"),a.createElement("div",{className:"col"},a.createElement("input",{type:"number",onChange:s.handleChange,value:s.values.monedas,min:"0",className:"form-control input-cierre",name:"monedas"}))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement("h4",null,"Total:")),a.createElement("div",{className:"col"},a.createElement("h5",{id:"totalCierre"},S(l)))),a.createElement("div",{className:"form-group"},a.createElement("button",{className:"btn btn-primary",type:"submit"},"Pagar")))))},Z=fe;var i=M(x());var he=({selectedCustomer:e,show:o,onClose:r})=>{let[c,l]=i.useState([]),u=k({initialValues:{name:""},onSubmit:async({name:C})=>{let{data:y}=await Q(C);l(y)}}),s=()=>{l([]),r(b.findCustomer),u.resetForm()};return i.createElement(h,{show:o,onHide:s},i.createElement(h.Header,null,i.createElement("h5",{className:"modal-title",id:"exampleModalLabel"},"Agregar Cliente a Venta"),i.createElement("button",{type:"button",className:"btn-close",onClick:s})),i.createElement(h.Body,null,i.createElement("form",{onSubmit:u.handleSubmit},i.createElement("div",{className:"form-group row"},i.createElement("div",{className:"col-9"},i.createElement("input",{className:"form-control",placeholder:"Buscar...",name:"name",value:u.values.name,onChange:u.handleChange})),i.createElement("div",{className:"col-3"},i.createElement("button",{className:"btn btn-primary",type:"submit"},"Buscar")))),i.createElement("div",null,i.createElement("table",{style:{width:"100%"}},i.createElement("thead",null,i.createElement("tr",null,i.createElement("th",null,"Cliente"),i.createElement("th",null,"Acci\xF3n"))),i.createElement("tbody",null,c.map((C,y)=>i.createElement("tr",{key:y},i.createElement("td",null,C.nombre),i.createElement("td",null,i.createElement("button",{className:"btn btn-sm btn-success",onClick:()=>{e(C),s()}},"Agregar")))))))))},ee=he;var m=M(x());var Ce=({selectedProduct:e,show:o,onClose:r})=>{let[c,l]=m.useState([]),u=k({initialValues:{name:""},onSubmit:async({name:C})=>{let{data:y}=await z(C);l(y)}}),s=()=>{l([]),r(b.findProduct),u.resetForm()};return m.createElement(h,{show:o,onHide:s},m.createElement(h.Header,null,m.createElement("h5",{className:"modal-title",id:"exampleModalLabel"},"Agregar Producto a Venta"),m.createElement("button",{type:"button",className:"btn-close",onClick:s})),m.createElement(h.Body,null,m.createElement("form",{onSubmit:u.handleSubmit},m.createElement("div",{className:"form-group row"},m.createElement("div",{className:"col-9"},m.createElement("input",{className:"form-control",placeholder:"Buscar...",name:"name",value:u.values.name,onChange:u.handleChange})),m.createElement("div",{className:"col-3"},m.createElement("button",{className:"btn btn-primary",type:"submit"},"Buscar")))),m.createElement("div",null,m.createElement("table",{style:{width:"100%"}},m.createElement("thead",null,m.createElement("tr",null,m.createElement("th",null,"Producto"),m.createElement("th",null,"Acci\xF3n"))),m.createElement("tbody",null,c.map((C,y)=>m.createElement("tr",{key:y},m.createElement("td",null,C.nombre),m.createElement("td",null,m.createElement("button",{className:"btn btn-sm btn-success",onClick:()=>e(C)},"Agregar")))))))))},ae=Ce;var w=M(x());var Ne=({onPaid:e,show:o,onClose:r})=>{let c=k({initialValues:{paid:""},onSubmit:async({paid:u})=>{let{data:s}=await G(u);e(s),l()}}),l=()=>{r(b.openCash),c.resetForm()};return w.createElement(h,{show:o,onHide:l},w.createElement(h.Header,null,w.createElement("h5",{className:"modal-title",id:"exampleModalLabel"},"Abrir Caja"),w.createElement("button",{type:"button",className:"btn-close",onClick:l})),w.createElement(h.Body,null,w.createElement("form",{onSubmit:c.handleSubmit},w.createElement("div",{className:"form-group"},w.createElement("h4",null,"Recibe:"),w.createElement("input",{className:"form-control",name:"paid",type:"number",required:!0,value:c.values.paid,onChange:u=>{c.handleChange(u)}})),w.createElement("div",{className:"form-group"},w.createElement("button",{className:"btn btn-primary",disabled:c.values.paid==0,type:"submit"},"Abrir")))))},te=Ne;var p=M(x());var ye=({onPaid:e,show:o,onClose:r,total:c})=>{let[l,u]=p.useState(0),s=k({initialValues:{paid:""},onSubmit:async({paid:y})=>{await e({total:c,cambio:l,paid:y}),C()}}),C=()=>{u(0),r(b.paidSale),s.resetForm()};return p.useEffect(()=>{u(s.values.paid-c)},[s.values.paid]),p.createElement(h,{show:o,onHide:C},p.createElement(h.Header,null,p.createElement("h5",{className:"modal-title",id:"exampleModalLabel"},"Pagar Venta"),p.createElement("button",{type:"button",className:"btn-close",onClick:C})),p.createElement(h.Body,null,p.createElement("form",{onSubmit:s.handleSubmit},p.createElement("div",{className:"form-group"},p.createElement("h4",null,"Total Venta:"),p.createElement("span",null,S(c))),p.createElement("div",{className:"form-group"},p.createElement("h4",null,"Recibe:"),p.createElement("input",{className:"form-control",name:"paid",type:"number",required:!0,value:s.values.paid,onChange:s.handleChange}),p.createElement("div",{className:"form-group"},p.createElement("h4",null,"Cambio Venta:"),p.createElement("span",null,S(l))),p.createElement("div",{className:"col-3"},p.createElement("button",{className:"btn btn-primary",disabled:l<0||s.values.paid==0,type:"submit"},"Pagar"))))))},oe=ye;var N=M(x());var ge=({customer:e,total:o,onCancelSale:r,onCloseSale:c})=>N.createElement(N.Fragment,null,N.createElement("div",{className:"col-4"},N.createElement("div",{className:"card"},N.createElement("div",{className:"card-body"},N.createElement("div",{className:"row"},N.createElement("div",{className:"col"},N.createElement("dl",null,N.createElement("dt",null,"Cliente"),N.createElement("dd",{id:"infoCliente"},(e==null?void 0:e.nombre)||"---"),N.createElement("dt",null,"Total"),N.createElement("dd",{id:"totalVentaDetalle"},S(o))))),N.createElement("div",{className:"row"},N.createElement("div",{className:"col"},N.createElement("button",{id:"cancelarVenta",className:"btn btn-danger mr-1",onClick:r},"Cancelar"),N.createElement("button",{className:"btn btn-success",disabled:e===null,onClick:c},"Finalizar"))))))),se=ge;var d=M(x());var Se=({products:e,total:o,onUpdateQuantity:r,onDeleteProduct:c})=>d.createElement(d.Fragment,null,d.createElement("table",{className:"table table-bordered"},d.createElement("thead",null,d.createElement("tr",null,d.createElement("td",null,"Producto"),d.createElement("td",null,"Precio"),d.createElement("td",null,"Cantidad"),d.createElement("td",null,"Total"),d.createElement("td",null))),d.createElement("tbody",null,e.map((l,u)=>d.createElement("tr",{key:u},d.createElement("td",null,l.nombre),d.createElement("td",null,S(l.precio)),d.createElement("td",null,d.createElement("input",{type:"number",min:1,value:l.cantidad,onChange:s=>r(l,s.target.value)})),d.createElement("td",null,S(l.cantidad*l.precio)),d.createElement("td",null,d.createElement("button",{className:"btn btn-sm btn-danger",onClick:()=>c(l)},"Borrar"))))),d.createElement("tfoot",null,d.createElement("tr",{className:"tx-blod"},d.createElement("td",{colSpan:"2"}),d.createElement("td",null,"TOTAL"),d.createElement("td",{id:"totalVentaTabla"},S(o)))))),le=Se;var we=document.getElementById("divContainer"),Pe=(0,ne.createRoot)(we),Re={findProduct:!1,findCustomer:!1,closeCash:!1,openCash:!1,paidSale:!1},Me=(e,o)=>{switch(o.modal){case b.findProduct:return R(P({},e),{[o.modal]:o.value});case b.findCustomer:return R(P({},e),{[o.modal]:o.value});case b.paidSale:return R(P({},e),{[o.modal]:o.value});case b.openCash:return R(P({},e),{[o.modal]:o.value});case b.closeCash:return R(P({},e),{[o.modal]:o.value})}},ke=()=>{let[e,o]=n.useState(()=>_(A)?JSON.parse(j(A)):[]),[r,c]=n.useState(()=>_(O)?JSON.parse(j(O)):null),[l,u]=n.useState(()=>_(D)?JSON.parse(j(D)):null),[s,C]=n.useState(0),[y,B]=n.useReducer(Me,Re),E=t=>B({modal:t,value:!1}),T=t=>{t=R(P({},t),{idCliente:new Number(t.idCliente)}),H(O,JSON.stringify(t)),c(t)},L=()=>{o([]),c(null)},re=()=>{B({modal:b.paidSale,value:!0})},de=t=>{console.log(t);let v=$(r,t);t=R(P({},t),{mayoreo:new Number(t.mayoreo),medida:new Number(t.medida),medio:new Number(t.medio),venta:new Number(t.venta),precio:v,cantidad:1}),console.log(t),o([...e,t])},ie=(t,v)=>{let g=t.cantidad+v,I=e.map(F=>F.idProducto===t.idProducto?R(P({},F),{cantidad:g}):F);o(I)},me=(t,v)=>{let g=v,I=e.map(F=>F.idProducto===t.idProducto?R(P({},F),{cantidad:g}):F);o(I)},ce=t=>e.findIndex(v=>v.idProducto===t.idProducto)>-1,ue=t=>{let v=e.findIndex(I=>I.idProducto===t.idProducto);return e[v]},be=t=>{(async()=>{if(await X(t)){if(ce(t)){let g=ue(t);ie(g,1)}else de(t);B({modal:b.findProduct,value:!1})}})()};return n.useEffect(()=>{(()=>{H(A,JSON.stringify(e));let t=e.reduce((v,g)=>v+=g.cantidad*$(r,g),0);C(t)})()},[e,r]),n.useEffect(()=>{H(O,JSON.stringify(r))},[r]),n.useEffect(()=>{l||B({modal:b.openCash,value:!0})},[]),n.useEffect(()=>{H(D,JSON.stringify(l))},[l]),n.createElement(n.Fragment,null,n.createElement(U,{openModal:({modal:t,value:v})=>{B({modal:t,value:v})},customer:r}),n.createElement("div",{className:"row"},n.createElement("div",{className:"col-8"},n.createElement("div",{className:"card"},n.createElement("div",{className:"card-body"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col table-responsive"},n.createElement(le,{products:e,total:s,onDeleteProduct:()=>{},onUpdateQuantity:(t,v)=>{me(t,v)}})))))),n.createElement(se,{customer:r,total:s,onCloseSale:re,onCancelSale:L})),n.createElement(ae,{show:y.findProduct,onClose:E,selectedProduct:be}),n.createElement(ee,{show:y.findCustomer,onClose:E,selectedCustomer:T}),n.createElement(oe,{show:y.paidSale,onClose:E,total:s,onPaid:async({total:t,cambio:v,paid:g})=>{let{data:I,success:F}=await q({total:t,cambio:v,paid:g,customer:r,products:e});F&&L()}}),n.createElement(te,{show:y.openCash,onClose:E,onPaid:({id:t,monto:v})=>{u({id:t,monto:v})}}),n.createElement(Z,{show:y.closeCash,onClose:E,montoInicial:(l==null?void 0:l.monto)||0,onPaid:async t=>{let{data:v,success:g}=await W(l.id,t);g&&Y(D)}}))};Pe.render(n.createElement(ke,null));
//# sourceMappingURL=index.js.map
